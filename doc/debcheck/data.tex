%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Copyright (C) 2010-2011  Pietro Abate <pietro.abate@pps.jussieu.fr>   %
%                           Ralf Treinen <ralf.treinen@pps.jussieu.fr>   %
%                           Unversit√© Paris-Diderot                      %
%                                                                        %
%  This documentation is free software: you can redistribute it and/or   %
%  modify it under the terms of the GNU General Public License as        %
%  published by the Free Software Foundation, either version 3 of the    %
%  License, or (at your option) any later version.                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Input Data: Packages and Repositories}
\label{sec:data}
\subsection{Packages}
\label{sec:packages}
Debian control stanzas are defined in \texttt{deb-control~(5)}. For
\debcheck{} only the following fields are relevant, all others are
ignored:
\begin{description}
\item[Package] giving the package name. \debcheck{} is more liberal as
  to which package names are acceptable, for instance it allows a
  slightly larger character set than the debian policy for
  constituting names. Required.
\item[Version] giving the version of the package. The version must be
  in conformance with the Debian policy. Required.
\item[Architecture] specifying the architectures on which the package
  may be installed. Required.
\item[Depends] is a list of items required for the installation of
  this package. Each item is a package name optionally with a version
  constraint, or a disjunction of these. Optional, defaults to the
  empty list.
\item[Pre-Depends] are by \debcheck{} treated like Depends.
\item[Conflicts] is a list of package names, possibly with a version
  constraint, that cannot be installed together with the package. Optional,
  defaults to the empty list.
\item[Breaks] are by \debcheck{} treated like Conflicts.
\item[Provides] is a list of names symbolizing functionalities
  realized by the package. They have to be taken into account for
  dependencies and conflicts of other packages, see
  Section~\ref{sec:installability}. Optional, defaults to the empty
  list.
\item[Essential] specifies whether the package must be installed
  (\texttt{yes} or \texttt{no}). Optional, defaults to \texttt{no}.
\end{description}

In particular, \texttt{Recommends} and \texttt{Suggests} are ignored
by \debcheck. Also, \debcheck{} does not check for the presence of
fields that are required by Debian policy but that are not relevant
for the task of \debcheck, like \texttt{Maintainer} or
\texttt{Description}.

Also note that \debcheck{} is slightly more liberal than the Debian
policy in accepting input, and hence cannot be used to check strict
policy conformance of package stanzas.

\subsection{Repositories}
\label{sec:repositories}
A \emph{repository} is a set of package stanzas. This set may be given
to \debcheck{} in form of a single file or as several files, in the
latter case the repository is constituted by all stanzas in all input
files (see Section~\ref{sec:invocation}). \debcheck{} makes two
important assumptions on the repositories; if any of these is not
satisfied then it exits with an error:

\begin{itemize}
\item
  We assume that there are no two package stanzas in the repository
  that have both the same value of \texttt{Package} and the same value
  of \texttt{Version}. Having different versions for the same package
  name is OK, as it is of course OK to have two stanzas with different
  package names and the same version.

  As a consequence, the pair of package name and package version is a
  unique identifier of a package stanza inside a given repository. In
  the following, when we speak of \emph{a package}, we mean a precise
  package stanza that is identified by a name \emph{and} a version,
  like the package of name \texttt{gcc} in version \texttt{4:4.3.2-2}.
  The stanza with name \texttt{gcc} and version \texttt{4:4.4.4-2}
  would constitute a different package.

  It is allowed that the \emph{same} package stanza occurs several
  time in the input, in that case all copies after the first one are
  simply ignored. In this context, two package stanzas are considered
  the same when they have the same value for all the fields that are
  listed in Section~\ref{sec:packages}.
\item
  We assume that the values of the \texttt{Architecture} fields are
  consistent, that is that there exists a single architecture that
  matches all these architecture values. Currently (policy version
  3.9.1), this means that all architecture values are either
  \texttt{all}, or the same specific architecture.

  An exception is the \texttt{-a \textit{<architecture>}} option which
  allows to restrict the repository to those package stanzas who's
  architecture field is consistent with a given concrete architecture
  (see Section~\ref{sec:invocation}).
\end{itemize}

\begin{example} The following input does not constitute a repository:
\begin{verbatim}
Package: abc
Version: 42
Architecture: amd64
Depends: xyz

Package: abc
Version: 42
Architecture: amd64
Depends: pqr
\end{verbatim}
The reason is that the package $(abc,42)$ is not unique. \debcheck{}
will reject such an input. After changing the version in the second
stanza to 43, for example, the input becomes correct.
\end{example}

% XXX This is going to change with multi-arch \ldots soon
\begin{example} The following input does not constitute a repository either:
\begin{verbatim}
Package: abc
Version: 42
Architecture: amd64

Package: def
Version: 43
Architecture: all

Package: ghi
Version: 44
Architecture: i386
\end{verbatim}
Here, the reason is that the architectures \texttt{amd64} and
\texttt{i386} are considered in contradiction. Dropping either the
first or the last package of the repository will fix the problem. Note
that this can also be achieved by using an architecture filter on the
input, see Section~\ref{sec:invocation}).
\end{example}


